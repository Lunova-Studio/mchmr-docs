---
title: 手动部署
description: 通用的部署方法，适用于所有服务器环境
icon: lucide:hard-drive-download
---

::card
---
icon: lucide:speech
---

#title
闲言碎语

#content
  ::div{class="mb-2"}
  手动部署之前，你需要在你的服务器上安装[快速上手](/getting-started/environment)中提到的环境：
  ::

  ::div{class="mb-2"}
  如果你在部署过程中遇到问题，需要在 QQ 群找热心群友协助，你应该提供错误日志
  ::

  > Troubleshooting any problem without the error log is like driving with your eyes closed.
  >
  > 在没有错误日志的情况下诊断任何问题，无异于闭眼开车。
  > <p class="text-end">—— Apache 官方文档 Getting started 篇章</p>
::

## 部署流程

::tabs
  ::div{label="前端部署"}
    ::steps
      ### 解压 McHMR 程序包

      将下载的McHMR 程序包打开，你会看到【版本管理端前端】目录，其中还存在一个 `dist.zip` 的压缩包，将压缩包内的所有文件解压到 Nginx 的 `html` 目录中；

      ### 配置伪静态

      打开 Nginx 的 `conf` 目录，找到 `nginx.conf` 文件，配置伪静态，打开配置文件后，你可能会看到以下内容：

      ```nginx [nginx.conf] icon=vscode-icons:file-type-nginx line-numbers
      server {
          listen       80;
          listen       [::]:80;
          server_name  _;
          root         /var/www/html/xxx;
  
          include /etc/nginx/default.d/*.conf;

          location / { # [!code focus] [!code ++]
              try_files $uri $uri/ /index.html; # [!code focus] [!code ++]
          } # [!code focus] [!code ++]
      }
      ```

      在 `location / {}` 块中配置 `try_files $uri $uri/ /index.html;`，如果没有 `location / {}` 块，请参照上方自行添加。

      你可以复制以下内容快速粘贴。

      ```nginx line-numbers
      location / { 
          try_files $uri $uri/ /index.html; 
      } 
      ```

      ### 配置前端连接后端 API

      修改 Nginx `html` 目录下的 `webConfig.js` 中的 `webApiBaseUrl` 的值，为你**后端**的 URL 地址，通常情况下是你的公网 IP 和后端端口的拼接，此处可以使用域名。

      ::alert{type="warning" icon="lucide:triangle-alert"}
        **请使用公网 IP + 端口**。<br>
        为防止因未进行备案导致的拦截，尽量不要使用域名（如果有备案，推荐使用域名）；<br>
        阿里云、腾讯云等国内服务商的服务器可能会对网站服务拦截，请尽量避免使用大厂的服务器。<br>
        如果你购买的是香港、台湾等非大陆政府直接管辖地区的服务器，可以免受影响，域名可以正常使用，同时可以使用 80、443 等端口。
      ::

      ```js line-numbers
      window.webConfig = {
          "webApiBaseUrl": "http://5.5.5.5:8080",
        //"webApiBaseUrl": "http://example.com:8080",
      }
      ```

      ### 启动前端
      打开 Terminal (终端/Power Shell/CMD) 输入：

      ```sh
      nginx -s reload
      ```

      回车后，Nginx 会重新加载配置文件，前端开始运行。
    ::
  ::
  ::div{label="后端部署"}
    ::steps
      ### 解压 McHMR 程序包

      将下载的McHMR 程序包打开，你会看到【版本管理端后端】目录，请在你喜欢的位置创建一个新目录，将【版本管理端后端】目录中的所有文件解压到该目录中；

      ::file-tree
      ---
      title: 目录结构
      icon: lucide:folder-tree
      showArrow: false
      tree:
        - BackEnd:
          - SQL:
            - mchmr.sql
            - Fix-1.0.1.sql
            - ...
          - Start for Linux.sh 
          - Start for windows.bat 
          - application.yml 
      ---
      ::


      ### 登录数据库

      打开 Terminal (终端/Power Shell/CMD) 输入：

      ```sh
      mysql -u 你的用户名 -p
      ```

      回车后输入密码（注意：密码输入时不会显示在屏幕上），输入完成后直接回车即可登录（如果这一步骤出现了未识别的命令错误，说明没有配置 Mysql 环境变量）。

      ### 创建数据库

      ```sql
        CREATE DATABASE mchmr;
      ```

      ### 选择到数据库

      ```sql
        USE mchmr;
      ```

      ### 导入数据库
      
      下面的数据库文件，复制后端目录中 `SQL` 目录中的 `mchmr.sql` 的绝对路径粘贴上去（注意使用单引号，双引号会报错）

      ```sql
        SOURCE '数据库文件'
      ```

      ### 编辑数据库配置

      编辑后端目录中的 `application.yml` 文件，高亮部分为你的数据库配置。

      ```yml line-numbers=48
      # more code
                  validationQuery: SELECT 1 FROM DUAL
                  testWhileIdle: true
                  testOnBorrow: false
                  testOnReturn: false
              datasource:
                  master:
                      url: jdbc:mysql://localhost:3306/mchmr?useUnicode=true&characterEncoding=utf8&zeroDateTimeBehavior=convertToNull&useSSL=true&serverTimezone=GMT%2B8 # [!code focus]
                      username: root # [!code focus]
                      password: 123456 # [!code focus]

      redis:
          host: localhost
          port: 6379
          database: 1
          timeout: 10s
      # more code
      ```

      如果你在创建数据库阶段没有修改数据库名称 `mchmr`，第 `55` 行可以忽略修改，如果你在创建数据库阶段修改了数据库名称，只需要将其中的 `mchmr` 修改为你修改的数据库名称；

      56, 57 分别修改为你数据库的<mark>用户名</mark>和<mark>密码</mark>；

      ### 启动后端

      Windows 环境下打开 `Start for windows.bat` 文件启动后端；
      
      Linux 环境下运行 `Start for Linux.sh` 文件启动后端。

    ::
  ::
::

## 访问地址

::alert{type="success" icon="lucide:lightbulb"}
  恭喜你，McHMR 已经部署完成！接下来，你可以通过以下地址访问 McHMR。如果使用时出现问题，可以看看[常见问题](/blog/faq)，或者到 QQ 群中寻求帮助。
::

- **内网**：`http://127.0.0.1:{port}`
- **公网**：`http://{IP}:{port}` 或 `http://{域名}:{port}`

::alert{type="note" icon="lucide:pencil"}
  **port**：在 Nginx 配置的端口<br>
  **IP**: 你的公网 IP<br>
  **域名**：如果有可使用
::


## 协作部署

我们提供了协作部署的方案，如果你觉得部署流程太复杂，或者部署过程中出现了问题，可以通过爱发电，选择合适的方案后，下载下方文件，填写文件内的详细信息，再添加群主的 QQ，发送这份文件，确定时间后为你部署。

[（协作前准备）文件下载](https://xiaofans.lanzouq.com/ihEc32egbs0h)